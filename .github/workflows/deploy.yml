name: Build & Deploy Telegrammsg Angular App

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      ACTIONS_RUNNER_DEBUG: true      # verbose runner logs
      ACTIONS_STEP_DEBUG: true        # verbose step logs

    steps:
      # 1ï¸âƒ£ Checkout code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2ï¸âƒ£ Setup Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 16

      # 3ï¸âƒ£ Install dependencies
      - name: Install dependencies
        run: |
          echo "ğŸ“¦ Installing npm dependencies..."
          npm install

      # 4ï¸âƒ£ Debug: list repo root files
      - name: List root folder
        run: |
          echo "ğŸ“ Listing root folder:"
          ls -R

      # 5ï¸âƒ£ Debug: list projects folder
      - name: List projects folder
        run: |
          echo "ğŸ“ Listing projects folder:"
          ls -R projects/

      # 6ï¸âƒ£ Create env.js using Node.js script
      - name: Create env.js
        run: |
          echo "ğŸ“ Running Node.js script to create env.js"
          node scripts/create-env.js

      # 7ï¸âƒ£ Debug: verify env.js creation
      - name: Verify env.js
        run: |
          echo "ğŸ” Checking if env.js exists..."
          if [ -f projects/telegrammsg/src/assets/env.js ]; then
            echo "âœ… env.js exists, contents below:"
            cat projects/telegrammsg/src/assets/env.js
          else
            echo "âŒ env.js not found"
          fi

      # 8ï¸âƒ£ Debug: list assets folder
      - name: List assets folder
        run: |
          echo "ğŸ“ Listing assets folder contents:"
          ls -l projects/telegrammsg/src/assets/

      # 9ï¸âƒ£ Build telegrammsg project
      - name: Build Telegrammsg Angular App
        run: |
          echo "ğŸ— Building Angular project 'telegrammsg'..."
          npx ng build telegrammsg --configuration production

      # ğŸ”Ÿ Optional: Deploy to GitHub Pages
      # - name: Deploy to GitHub Pages
      #   uses: peaceiris/actions-gh-pages@v3
      #   with:
      #     github_token: ${{ secrets.GITHUB_TOKEN }}
      #     publish_dir: ./dist/telegrammsg
